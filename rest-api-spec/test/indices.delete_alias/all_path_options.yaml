---
setup:

  - do:
      indices.create:
        index: test_index1
        
  - do:
      indices.create:
        index: test_index2

  - do:
      indices.put_alias:
        index: test_index1
        name:  alias1
        body:
          routing: "routing value"
  - do:
      indices.put_alias:
        index: test_index1
        name:  alias2
        body:
          routing: "routing value"
          
  - do:
      indices.put_alias:
        index: test_index2
        name:  alias1
        body:
          routing: "routing value"
          
  - do:
      indices.put_alias:
        index: test_index2
        name:  alias2
        body:
          routing: "routing value"
          
---
"check setup":
  - do:
      indices.get_alias:
        name: alias1

  - match: {test_index1.aliases.alias1.search_routing: "routing value"}
  - match: {test_index1.aliases.alias1.index_routing: "routing value"}
  - match: {test_index2.aliases.alias1.search_routing: "routing value"}
  - match: {test_index2.aliases.alias1.index_routing: "routing value"}
  
  - do:
      indices.get_alias:
        name: alias2

  - match: {test_index1.aliases.alias2.search_routing: "routing value"}
  - match: {test_index1.aliases.alias2.index_routing: "routing value"}
  - match: {test_index2.aliases.alias2.search_routing: "routing value"}
  - match: {test_index2.aliases.alias2.index_routing: "routing value"}

---
"check delete with _all index":
  - do:
      indices.delete_alias:
        index: _all
        name: alias1

  - do:
      catch: missing
      indices.get_alias:
        index: test_index1
        name:  alias1
  - do:
      indices.get_alias:
        name: alias2

  - match: {test_index1.aliases.alias2.search_routing: "routing value"}
  - match: {test_index1.aliases.alias2.index_routing: "routing value"}
  - match: {test_index2.aliases.alias2.search_routing: "routing value"}
  - match: {test_index2.aliases.alias2.index_routing: "routing value"}
  
---
"check delete with * index":
  - do:
      indices.delete_alias:
        index: "*"
        name: alias1

  - do:
      catch: missing
      indices.get_alias:
        index: test_index1
        name:  alias1
  - do:
      indices.get_alias:
        name: alias2

  - match: {test_index1.aliases.alias2.search_routing: "routing value"}
  - match: {test_index1.aliases.alias2.index_routing: "routing value"}
  - match: {test_index2.aliases.alias2.search_routing: "routing value"}
  - match: {test_index2.aliases.alias2.index_routing: "routing value"}
  
---
"check delete with index list":
  - do:
      indices.delete_alias:
        index: "test_index1,test_index2"
        name: alias1

  - do:
      catch: missing
      indices.get_alias:
        index: test_index1
        name:  alias1
  - do:
      catch: missing
      indices.get_alias:
        index: test_index2
        name:  alias1
        
  - do:
      indices.get_alias:
        name: alias2

  - match: {test_index1.aliases.alias2.search_routing: "routing value"}
  - match: {test_index1.aliases.alias2.index_routing: "routing value"}
  - match: {test_index2.aliases.alias2.search_routing: "routing value"}
  - match: {test_index2.aliases.alias2.index_routing: "routing value"}
  
  
---
"check delete with index list and * aliases":
  - do:
      indices.delete_alias:
        index: "test_index1,test_index2"
        name: "*"

  - do:
      catch: missing
      indices.get_alias:
        index: test_index1
        name:  alias1
  - do:
      catch: missing
      indices.get_alias:
        index: test_index2
        name:  alias1
  - do:
      catch: missing
      indices.get_alias:
        index: test_index1
        name:  alias2
  - do:
      catch: missing
      indices.get_alias:
        index: test_index2
        name:  alias2


---
"check delete with index list and _all aliases":
  - do:
      indices.delete_alias:
        index: "test_index1,test_index2"
        name: _all

  - do:
      catch: missing
      indices.get_alias:
        index: test_index1
        name:  alias1
  - do:
      catch: missing
      indices.get_alias:
        index: test_index2
        name:  alias1
  - do:
      catch: missing
      indices.get_alias:
        index: test_index1
        name:  alias2
  - do:
      catch: missing
      indices.get_alias:
        index: test_index2
        name:  alias2
        
---
"check delete with index list and wildcard aliases":
  - do:
      indices.delete_alias:
        index: "test_index1,test_index2"
        name: "*1"

  - do:
      catch: missing
      indices.get_alias:
        index: test_index1
        name:  alias1
  - do:
      catch: missing
      indices.get_alias:
        index: test_index2
        name:  alias1
  - do:
      indices.get_alias:
        name: alias2

  - match: {test_index1.aliases.alias2.search_routing: "routing value"}
  - match: {test_index1.aliases.alias2.index_routing: "routing value"}
  - match: {test_index2.aliases.alias2.search_routing: "routing value"}
  - match: {test_index2.aliases.alias2.index_routing: "routing value"}
        


